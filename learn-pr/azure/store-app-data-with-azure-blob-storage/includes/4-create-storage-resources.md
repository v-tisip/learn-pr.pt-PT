<span data-ttu-id="76062-101">Assim que tivermos uma ideia sobre como vamos armazenar dados entre contas de armazenamento, contentores e blobs, podemos pensar sobre os recursos do Azure que temos de criar para suportar a aplicação.</span><span class="sxs-lookup"><span data-stu-id="76062-101">Once we have an idea of how we're going to store data across storage accounts, containers and blobs, we can think about the Azure resources we need to create to support the app.</span></span>

### <a name="storage-accounts"></a><span data-ttu-id="76062-102">Contas de armazenamento</span><span class="sxs-lookup"><span data-stu-id="76062-102">Storage accounts</span></span>

<span data-ttu-id="76062-103">A criação da conta de armazenamento é uma atividade administrativa/gestão que ocorre antes de implementar e executar a sua aplicação.</span><span class="sxs-lookup"><span data-stu-id="76062-103">Storage account creation is an administrative/management activity that takes place prior to deploying and running your app.</span></span> <span data-ttu-id="76062-104">As contas são, normalmente, criadas por um script de configuração de implementação ou ambiente, um modelo do Azure Resource Manager ou manualmente por um administrador.</span><span class="sxs-lookup"><span data-stu-id="76062-104">Accounts are usually created by a deployment or environment setup script, an Azure Resource Manager template, or manually by an administrator.</span></span> <span data-ttu-id="76062-105">As aplicações que não são ferramentas administrativas, geralmente não devem ter permissões para criar contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="76062-105">Applications other than administrative tools generally should not have permissions to create storage accounts.</span></span>

### <a name="containers"></a><span data-ttu-id="76062-106">Contentores</span><span class="sxs-lookup"><span data-stu-id="76062-106">Containers</span></span>

<span data-ttu-id="76062-107">Ao contrário da criação da conta de armazenamento, a criação do contentor é uma atividade simples que faz sentido executar a partir de uma aplicação.</span><span class="sxs-lookup"><span data-stu-id="76062-107">Unlike storage account creation, container creation is a lightweight activity that makes sense to perform from within an app.</span></span> <span data-ttu-id="76062-108">É habitual as aplicações criarem e eliminarem contentores como parte do seu trabalho.</span><span class="sxs-lookup"><span data-stu-id="76062-108">It's not uncommon for apps to create and delete containers as part of their work.</span></span>

<span data-ttu-id="76062-109">Para aplicações que dependem de um conjunto conhecido de contentores com nomes codificados ou pré-configurados, o mais habitual é permitir que a aplicação crie os contentores que precisa ao arrancar ou na primeira utilização, se ainda não existirem.</span><span class="sxs-lookup"><span data-stu-id="76062-109">For apps that rely on a known set of containers with hard-coded or preconfigured names, typical practice is to let the app create the containers it needs on startup or first usage if they don't already exist.</span></span> <span data-ttu-id="76062-110">Permitir que a sua aplicação possa criar contentores, em vez de fazê-lo como parte da implementação da aplicação, elimina a necessidade da sua aplicação e do processo de implementação conhecerem os nomes dos contentores que a aplicação utiliza.</span><span class="sxs-lookup"><span data-stu-id="76062-110">Letting your app create containers instead of doing it as part of your app's deployment eliminates the need for both your application and your deployment process to know the names of the containers the app uses.</span></span>

## <a name="exercise"></a><span data-ttu-id="76062-111">Exercício</span><span class="sxs-lookup"><span data-stu-id="76062-111">Exercise</span></span>

<span data-ttu-id="76062-112">Vamos concluir uma aplicação ASP.NET Core incompleta ao adicionar código para utilizar o armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="76062-112">We're going to complete an unfinished ASP.NET Core app by adding code to use Azure Blob storage.</span></span> <span data-ttu-id="76062-113">Este exercício é mais sobre explorar a API de armazenamento de Blobs, do que estruturar uma organização e esquema de nomenclatura, mas aqui está uma rápida descrição geral da aplicação e como ela armazena dados:</span><span class="sxs-lookup"><span data-stu-id="76062-113">This exercise is more about exploring the Blob storage API than it is about designing an organization and naming scheme, but here's a quick overview of the app and how it stores data:</span></span>

<span data-ttu-id="76062-114">**Captura de ecrã da lista de tarefas da aplicação, uma vez que não poderá ser vista até ao fim**</span><span class="sxs-lookup"><span data-stu-id="76062-114">**TODO screenshot of app, since they're not going to see it run until the end**</span></span>

<span data-ttu-id="76062-115">A nossa aplicação funciona como uma pasta partilhada que aceita carregamentos de ficheiros e torna-os disponíveis para download.</span><span class="sxs-lookup"><span data-stu-id="76062-115">Our app works like a shared folder that accepts file uploads and makes them available for download.</span></span> <span data-ttu-id="76062-116">Ela não utiliza uma base de dados para organizar os blobs &mdash;, em vez disso, limpa os nomes dos ficheiros carregados e utiliza-os diretamente como nomes de blobs.</span><span class="sxs-lookup"><span data-stu-id="76062-116">It doesn't use a database for organizing blobs &mdash; instead, it sanitizes the names of uploaded files and uses them as blob names directly.</span></span> <span data-ttu-id="76062-117">Todos os ficheiros carregados são armazenados num único contentor.</span><span class="sxs-lookup"><span data-stu-id="76062-117">All uploaded files are stored in a single container.</span></span>

<span data-ttu-id="76062-118">O código com que vamos começar é compilado e executado, mas as partes responsáveis por armazenar e carregar os dados estão vazias.</span><span class="sxs-lookup"><span data-stu-id="76062-118">The code we'll start with compiles and runs, but the parts responsible for storing and loading data are empty.</span></span> <span data-ttu-id="76062-119">Depois de concluirmos o código, iremos implementar a aplicação no Serviço de Aplicações do Azure e testá-la.</span><span class="sxs-lookup"><span data-stu-id="76062-119">After we complete the code, we'll deploy the app to Azure App Service and test it.</span></span>

<span data-ttu-id="76062-120">Vamos configurar a infraestrutura de armazenamento na nossa aplicação.</span><span class="sxs-lookup"><span data-stu-id="76062-120">Let's set up the storage infrastructure for our app.</span></span>

### <a name="resource-group-and-storage-account"></a><span data-ttu-id="76062-121">Grupo de recursos e conta de armazenamento</span><span class="sxs-lookup"><span data-stu-id="76062-121">Resource group and storage account</span></span>
<span data-ttu-id="76062-122">Em primeiro lugar, vamos criar um grupo de recursos para conter todos os recursos neste exercício.</span><span class="sxs-lookup"><span data-stu-id="76062-122">First, we'll create a resource group to contain all of the resources in this exercise.</span></span> <span data-ttu-id="76062-123">Vamos eliminá-lo no final para limpar tudo o que criamos.</span><span class="sxs-lookup"><span data-stu-id="76062-123">We'll delete it at the end to clean up everything we create.</span></span> <span data-ttu-id="76062-124">Também vamos criar a conta de armazenamento que a nossa aplicação irá utilizar para armazenar blobs.</span><span class="sxs-lookup"><span data-stu-id="76062-124">We'll also create the storage account our app will use to store blobs.</span></span>

<span data-ttu-id="76062-125">Utilize o terminal do Azure Cloud Shell para criar o grupo de recursos e a conta de armazenamento ao executar os seguintes comandos da CLI do Azure.</span><span class="sxs-lookup"><span data-stu-id="76062-125">Use the Azure Cloud Shell terminal to create the resource group and storage account by running the following Azure CLI commands.</span></span> <span data-ttu-id="76062-126">Terá de indicar um nome exclusivo para a conta de armazenamento &mdash;, tome nota da mesma para utilizar mais tarde.</span><span class="sxs-lookup"><span data-stu-id="76062-126">You'll need to provide a unique name for the storage account &mdash; make a note of it for later.</span></span> <span data-ttu-id="76062-127">A escolha de `eastus` para a localização é arbitrária.</span><span class="sxs-lookup"><span data-stu-id="76062-127">The choice of `eastus` for the location is arbitrary.</span></span>

```console
az group create --name blob-exercise-group --location eastus
az storage account create --name <your-unique-storage-account-name> --resource-group blob-exercise-group --location eastus --kind StorageV2
```

<span data-ttu-id="76062-128">**A lista de tarefas abaixo deve estar no módulo de Armazenamento do Azure**</span><span class="sxs-lookup"><span data-stu-id="76062-128">**TODO below should go in Azure Storage module**</span></span>

> [!NOTE]
> <span data-ttu-id="76062-129">Porquê `--kind StorageV2`?</span><span class="sxs-lookup"><span data-stu-id="76062-129">Why `--kind StorageV2`?</span></span> <span data-ttu-id="76062-130">Existem alguns tipos diferentes de contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="76062-130">There are a few different kinds of storage accounts.</span></span> <span data-ttu-id="76062-131">Na maioria dos cenários, deve utilizar contas de armazenamento para fins gerais v2 (demonstradas com `StorageV2`).</span><span class="sxs-lookup"><span data-stu-id="76062-131">For most scenarios, you should use general-purpose v2 storage accounts (signified with `StorageV2`).</span></span> <span data-ttu-id="76062-132">O único motivo de as contas de armazenamento v2 terem de ser especificadas aqui deve-se a ainda serem relativamente novas e não estarem predefinidas no Portal do Azure ou na CLI do Azure.</span><span class="sxs-lookup"><span data-stu-id="76062-132">The only reason v2 storage accounts need to be specified here is that they are still fairly new and have not yet been made the default in the Azure Portal or the Azure CLI.</span></span>

### <a name="container"></a><span data-ttu-id="76062-133">Contentor</span><span class="sxs-lookup"><span data-stu-id="76062-133">Container</span></span>
<span data-ttu-id="76062-134">A aplicação com que iremos trabalhar neste módulo utiliza um único contentor.</span><span class="sxs-lookup"><span data-stu-id="76062-134">The app we'll be working with in this module uses a single container.</span></span> <span data-ttu-id="76062-135">Vamos seguir a melhor prática de permitir que a aplicação crie o contentor no arranque.</span><span class="sxs-lookup"><span data-stu-id="76062-135">We're going to follow the best practice of letting the app create the container at startup.</span></span> <span data-ttu-id="76062-136">No entanto, a criação do contentor pode ser feita a partir da CLI do Azure: execute `az storage container create -h` no terminal do Cloud Shell, se gostaria de ver a documentação.</span><span class="sxs-lookup"><span data-stu-id="76062-136">However, container creation can be done from the Azure CLI: run `az storage container create -h` in the Cloud Shell terminal if you'd like to see the documentation.</span></span>