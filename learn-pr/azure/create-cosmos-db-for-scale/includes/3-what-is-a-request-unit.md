<span data-ttu-id="ea1b7-101">Em seguida iremos analisar os dados em toda a nossa base de dados.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-101">Next we'll consider the data throughout for our database.</span></span> <span data-ttu-id="ea1b7-102">Isto é importante para se certificar de que podemos trabalhar com um volume de transações para as nossas necessidades de negócio.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-102">This is important to ensure we can handle the volume of transactions for our business needs.</span></span> <span data-ttu-id="ea1b7-103">Os requisitos de débito nem sempre são consistentes.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-103">Throughput requirements aren't always consistent.</span></span> <span data-ttu-id="ea1b7-104">Por exemplo, pode criar um site de compras que precisa de ser dimensionado durante as vendas ou os feriados.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-104">For example, you may be building a shopping website that needs to scale during sales or holidays.</span></span> <span data-ttu-id="ea1b7-105">Vamos começar a estimar os requisitos de débito da base de dados.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-105">We'll start estimating your database throughput requirements.</span></span>

## <a name="what-is-database-throughput"></a><span data-ttu-id="ea1b7-106">O que é o débito da base de dados?</span><span class="sxs-lookup"><span data-stu-id="ea1b7-106">What is database throughput?</span></span> 

<span data-ttu-id="ea1b7-107">O débito da base de dados é o número de leituras e gravações que a sua base de dados pode realizar num segundo.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-107">Database throughput is the number of reads and writes that your database can perform in a single second.</span></span> 

<span data-ttu-id="ea1b7-108">Para dimensionar o débito estrategicamente, precisa de estimar as necessidades do débito ao estimar o número de leituras e gravações que terá de suportar em alturas diferentes e para tamanhos de documento diferentes.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-108">To scale throughput strategically, you need to estimate your throughput needs by estimating the number of reads and writes you'll have to support at different times and for different document sizes.</span></span> <span data-ttu-id="ea1b7-109">Se calcular corretamente, irá manter os seus utilizadores satisfeitos nos picos de procura.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-109">If you estimate correctly, you'll keep your users happy when demand spikes.</span></span> <span data-ttu-id="ea1b7-110">Se estimar incorretamente, os seus pedidos podem ficar com a taxa limitada e as operações terão de aguardar e tentar novamente, provavelmente causando uma alta latência e clientes insatisfeitos.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-110">If you estimate incorrectly, your requests can get rate-limited and operations will have to wait and retry, likely causing high latency and unhappy customers.</span></span>

## <a name="what-is-a-request-unit"></a><span data-ttu-id="ea1b7-111">O que é uma unidade de pedido?</span><span class="sxs-lookup"><span data-stu-id="ea1b7-111">What is a request unit?</span></span>

<span data-ttu-id="ea1b7-112">O Azure Cosmos DB mede o débito através de algo chamado de **unidade de pedido (RU)**.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-112">Azure Cosmos DB measures throughput using something called a **request unit (RU)**.</span></span> <span data-ttu-id="ea1b7-113">A utilização da unidade de pedido é medida por segundo, pelo que a unidade de medida é **unidades de pedido por segundo (RU/s)**.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-113">Request unit usage is measured per second, so the unit of measure is **request units per second (RU/s)**.</span></span> <span data-ttu-id="ea1b7-114">Tem de reservar o número de RU/s que pretende que o Azure Cosmos DB aprovisione antecipadamente, para que possa manipular a carga que estimou e aumentar ou reduzir verticalmente a sua RU/s em qualquer altura, para satisfazer o pedido atual.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-114">You must reserve the number of RU/s you want Azure Cosmos DB to provision in advance, so it can handle the load you've estimated, and you can scale your RU/s up or down at any time to meet current demand.</span></span>

## <a name="request-unit-basics"></a><span data-ttu-id="ea1b7-115">Noções básicas da unidade de pedido</span><span class="sxs-lookup"><span data-stu-id="ea1b7-115">Request unit basics</span></span>

<span data-ttu-id="ea1b7-116">Uma unidade de pedido único, 1 RU, é igual ao custo aproximado da execução de um pedido GET único num documento de 1 KB com o ID de documento.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-116">A single request unit, 1 RU, is equal to the approximate cost of performing a single GET request on a 1-KB document using a document's ID.</span></span> <span data-ttu-id="ea1b7-117">Executar um GET com o ID de documento é um meio eficiente para recuperar um documento e, portanto, o custo é pequeno.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-117">Performing a GET by using a document's ID is an efficient means for retrieving a document, and thus the cost is small.</span></span> <span data-ttu-id="ea1b7-118">Criar, substituir ou eliminar o mesmo item exige processamento adicional pelo serviço e, portanto, exige mais unidades de pedido.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-118">Creating, replacing, or deleting the same item requires additional processing by the service, and therefore requires more request units.</span></span>

<span data-ttu-id="ea1b7-119">O número de unidades de pedido utilizadas para uma operação é diferente consoante o tamanho do documento, o número de propriedades do documento, a operação a realizar e alguns conceitos complexos adicionais, como a consistência e a política de indexação.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-119">The number of request units used for an operation changes depending on the document size, the number of properties in the document, the operation being performed, and some additional complex concepts such as consistency and indexing policy.</span></span>

<span data-ttu-id="ea1b7-120">A tabela seguinte mostra o número de unidades de pedido que são precisas para itens de três tamanhos diferentes (1 KB, 4 KB e 64 KB) e em dois níveis de desempenho diferentes (500 leituras/segundo + 100 gravações/segundo e 500 leituras/segundo + 500 gravações/segundo).</span><span class="sxs-lookup"><span data-stu-id="ea1b7-120">The following table shows the number of request units required for items of three different sizes (1 KB, 4 KB, and 64 KB) and at two different performance levels (500 reads/second + 100 writes/second and 500 reads/second + 500 writes/second).</span></span> <span data-ttu-id="ea1b7-121">Neste exemplo, a consistência de dados está definida como **Sessão** e a política de indexação está definida como **Nenhuma**.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-121">In this example, the data consistency is set to **Session**, and the indexing policy is set to **None**.</span></span>

| <span data-ttu-id="ea1b7-122">Tamanho do item</span><span class="sxs-lookup"><span data-stu-id="ea1b7-122">Item size</span></span> | <span data-ttu-id="ea1b7-123">Leituras/segundo</span><span class="sxs-lookup"><span data-stu-id="ea1b7-123">Reads/second</span></span> | <span data-ttu-id="ea1b7-124">Gravações/segundo</span><span class="sxs-lookup"><span data-stu-id="ea1b7-124">Writes/second</span></span> | <span data-ttu-id="ea1b7-125">Unidades de pedidos</span><span class="sxs-lookup"><span data-stu-id="ea1b7-125">Request units</span></span>
| --- | --- | --- | --- |
| <span data-ttu-id="ea1b7-126">1 KB</span><span class="sxs-lookup"><span data-stu-id="ea1b7-126">1 KB</span></span> | <span data-ttu-id="ea1b7-127">500</span><span class="sxs-lookup"><span data-stu-id="ea1b7-127">500</span></span> | <span data-ttu-id="ea1b7-128">100</span><span class="sxs-lookup"><span data-stu-id="ea1b7-128">100</span></span> | <span data-ttu-id="ea1b7-129">(500 * 1) + (100 * 5) = 1.000 RU/s</span><span class="sxs-lookup"><span data-stu-id="ea1b7-129">(500 * 1) + (100 * 5) = 1,000 RU/s</span></span>
| <span data-ttu-id="ea1b7-130">1 KB</span><span class="sxs-lookup"><span data-stu-id="ea1b7-130">1 KB</span></span> | <span data-ttu-id="ea1b7-131">500</span><span class="sxs-lookup"><span data-stu-id="ea1b7-131">500</span></span> | <span data-ttu-id="ea1b7-132">500</span><span class="sxs-lookup"><span data-stu-id="ea1b7-132">500</span></span> | <span data-ttu-id="ea1b7-133">(500 * 1) + (500 * 5) = 3.000 RU/s</span><span class="sxs-lookup"><span data-stu-id="ea1b7-133">(500 * 1) + (500 * 5) = 3,000 RU/s</span></span>
| <span data-ttu-id="ea1b7-134">4 KB</span><span class="sxs-lookup"><span data-stu-id="ea1b7-134">4 KB</span></span> | <span data-ttu-id="ea1b7-135">500</span><span class="sxs-lookup"><span data-stu-id="ea1b7-135">500</span></span> | <span data-ttu-id="ea1b7-136">100</span><span class="sxs-lookup"><span data-stu-id="ea1b7-136">100</span></span> | <span data-ttu-id="ea1b7-137">(500 * 1,3) + (100 * 7) = 1.350 RU/s</span><span class="sxs-lookup"><span data-stu-id="ea1b7-137">(500 * 1.3) + (100 * 7) = 1,350 RU/s</span></span>
| <span data-ttu-id="ea1b7-138">4 KB</span><span class="sxs-lookup"><span data-stu-id="ea1b7-138">4 KB</span></span> | <span data-ttu-id="ea1b7-139">500</span><span class="sxs-lookup"><span data-stu-id="ea1b7-139">500</span></span> | <span data-ttu-id="ea1b7-140">500</span><span class="sxs-lookup"><span data-stu-id="ea1b7-140">500</span></span> | <span data-ttu-id="ea1b7-141">(500 * 1,3) + (500 * 7) = 4.150 RU/s</span><span class="sxs-lookup"><span data-stu-id="ea1b7-141">(500 * 1.3) + (500 * 7) = 4,150 RU/s</span></span>
| <span data-ttu-id="ea1b7-142">64 KB</span><span class="sxs-lookup"><span data-stu-id="ea1b7-142">64 KB</span></span> | <span data-ttu-id="ea1b7-143">500</span><span class="sxs-lookup"><span data-stu-id="ea1b7-143">500</span></span> | <span data-ttu-id="ea1b7-144">100</span><span class="sxs-lookup"><span data-stu-id="ea1b7-144">100</span></span> | <span data-ttu-id="ea1b7-145">(500 * 10) + (100 * 48) = 9.800 RU/s</span><span class="sxs-lookup"><span data-stu-id="ea1b7-145">(500 * 10) + (100 * 48) = 9,800 RU/s</span></span>
| <span data-ttu-id="ea1b7-146">64 KB</span><span class="sxs-lookup"><span data-stu-id="ea1b7-146">64 KB</span></span> | <span data-ttu-id="ea1b7-147">500</span><span class="sxs-lookup"><span data-stu-id="ea1b7-147">500</span></span> | <span data-ttu-id="ea1b7-148">500</span><span class="sxs-lookup"><span data-stu-id="ea1b7-148">500</span></span> | <span data-ttu-id="ea1b7-149">(500 * 10) + (500 * 48) = 29.000 RU/s</span><span class="sxs-lookup"><span data-stu-id="ea1b7-149">(500 * 10) + (500 * 48) = 29,000 RU/s</span></span>
 
<span data-ttu-id="ea1b7-150">Como pode ver, quanto maior for o item, mais leituras e gravações são precisas, mais unidades de pedido tem de reservar.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-150">As you can see, the larger the item is, and the more reads and writes are required, the more request units you need to reserve.</span></span> <span data-ttu-id="ea1b7-151">Se tiver de calcular as necessidades de débito de uma aplicação, o [Planeador de Capacidade](https://www.documentdb.com/capacityplanner) do Azure Cosmos DB é uma ferramenta online que lhe permite carregar um documento JSON de exemplo e definir o número de operações que tem de concluir por segundo.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-151">If you need to estimate the throughput needs of an application, the Azure Cosmos DB [Capacity Planner](https://www.documentdb.com/capacityplanner) is an online tool that enables you to upload a sample JSON document and set the number of operations you need to complete per second.</span></span> <span data-ttu-id="ea1b7-152">Em seguida, apresenta um total estimado para reservar.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-152">It then provides an estimated total to reserve.</span></span>

## <a name="exceeding-throughput-limits"></a><span data-ttu-id="ea1b7-153">A exceder os limites de débito</span><span class="sxs-lookup"><span data-stu-id="ea1b7-153">Exceeding throughput limits</span></span>

<span data-ttu-id="ea1b7-154">Se não reservar unidades de pedido suficientes e estiver a tentar ler ou gravar mais dados do que o débito aprovisionado permite, o seu pedido terá a taxa limitada.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-154">If you don’t reserve enough request units, and you attempt to read or write more data than your provisioned throughput allows, your request will be rate-limited.</span></span> <span data-ttu-id="ea1b7-155">Quando um pedido tem a taxa limitada, este tem de ser repetido novamente após um intervalo especificado.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-155">When a request is rate-limited, the request has to be retried again after a specified interval.</span></span> <span data-ttu-id="ea1b7-156">Se utilizar o SDK .NET, o pedido será repetido automaticamente após aguardar a quantidade de tempo especificada no cabeçalho repetir-após.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-156">If you use the .NET SDK, the request will be retried automatically after waiting the amount of time specified in the retry-after header.</span></span>

## <a name="creating-an-account-built-to-scale"></a><span data-ttu-id="ea1b7-157">Criar uma conta criada para dimensionamento</span><span class="sxs-lookup"><span data-stu-id="ea1b7-157">Creating an account built to scale</span></span>

<span data-ttu-id="ea1b7-158">Pode alterar o número de unidades de pedido aprovisionadas numa base de dados em qualquer altura.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-158">You can change the number of request units provisioned to a database at any time.</span></span> <span data-ttu-id="ea1b7-159">Por isso, durante períodos de volume pesados, pode aumentar verticalmente para acomodar essa procura elevada e, em seguida, reduzir o débito aprovisionado durante os horários fora de pico para reduzir os custos.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-159">So, during heavy volume periods, you can scale up to accommodate those high demands, and then reduce provisioned throughput during off peak times to reduce costs.</span></span>

<span data-ttu-id="ea1b7-160">Quando cria uma conta, pode aprovisionar um mínimo de 400 RU/s ou um máximo de 250.000 RU/s no portal.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-160">When you create an account, you can provision a minimum of 400 RU/s, or a maximum of 250,000 RU/s in the portal.</span></span> <span data-ttu-id="ea1b7-161">Se precisar de mais débito, preencha um pedido no portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-161">If you need even more throughput, fill out a ticket in the Azure portal.</span></span> <span data-ttu-id="ea1b7-162">É recomendado definir o débito inicial para 1000 RU/s para quase todas as contas, uma vez que é o valor mínimo no qual a sua base de dados será dimensionada automaticamente se precisar de mais de 10 GB de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-162">Setting the initial throughput to 1000 RU/s is recommended for almost all accounts, as it is the minimum value in which your database will autoscale should you need more than 10 GB of storage.</span></span> <span data-ttu-id="ea1b7-163">Se definir a taxa de débito inicial para qualquer valor inferior a 1000 RU/s, a base de dados não conseguirá dimensionar para mais de 10 GB, a menos que reaprovisione a base de dados e indique uma chave de partição.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-163">If you set the initial throughput to any value less than 1000 RU/s, your database will not be able to scale to larger than 10 GB unless you reprovision the database and provide a partition key.</span></span> <span data-ttu-id="ea1b7-164">As chaves de partição ativam uma pesquisa rápida de dados no Azure Cosmos DB para dimensionar automaticamente a base de dados quando é preciso.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-164">Partition keys enable quick lookup of data in Azure Cosmos DB and enable it to autoscale your database when needed.</span></span> <span data-ttu-id="ea1b7-165">As chaves de partição são abordadas na unidade seguinte.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-165">Partition keys are discussed in the next unit.</span></span>

## <a name="summary"></a><span data-ttu-id="ea1b7-166">Resumo</span><span class="sxs-lookup"><span data-stu-id="ea1b7-166">Summary</span></span>

<span data-ttu-id="ea1b7-167">Agora, já sabe como estimar e avaliar o débito para uma Azure Cosmos DB com unidades de pedido.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-167">You now understand how to estimate and scope throughput for an Azure Cosmos DB using request units.</span></span> <span data-ttu-id="ea1b7-168">As unidades de pedido podem ser modificadas em qualquer altura e defini-las para 1000 RU/s ao criar uma conta ajuda a garantir que a sua base de dados está pronta para ser dimensionada mais tarde.</span><span class="sxs-lookup"><span data-stu-id="ea1b7-168">Request units can be modified at any time, and setting them to 1000 RU/s when you create an account helps ensure your database is ready to scale later.</span></span>