<span data-ttu-id="da299-101">O revendedor online para quem trabalha, tem planos para expandir o negócio para uma nova área geográfica, num futuro próximo.</span><span class="sxs-lookup"><span data-stu-id="da299-101">The online retailer that you work for plans to expand to a new geographical area in the near future.</span></span> <span data-ttu-id="da299-102">Esta jogada vai aumentar a sua base de clientes e o seu volume de transações.</span><span class="sxs-lookup"><span data-stu-id="da299-102">This move will increase your customer base and transaction volume.</span></span> <span data-ttu-id="da299-103">Tem de garantir que a sua base de dados está equipada para suportar esta expansão, quando ela acontecer.</span><span class="sxs-lookup"><span data-stu-id="da299-103">You must ensure that your database is equipped to handle expansion whenever required.</span></span>

<span data-ttu-id="da299-104">Ter uma estratégia de partição garante que no momento em que a sua base de dados precisar de crescer, poderá fazê-lo de forma fácil, continuando a executar consultas e transações de forma eficiente.</span><span class="sxs-lookup"><span data-stu-id="da299-104">Having a partition strategy ensures that when your database needs to grow, it can do so easily and continue to perform efficient queries and transactions.</span></span>

## <a name="what-is-a-partition-strategy"></a><span data-ttu-id="da299-105">O que é uma estratégia de partição?</span><span class="sxs-lookup"><span data-stu-id="da299-105">What is a partition strategy?</span></span>

<span data-ttu-id="da299-106">Se continuar a adicionar novos dados a um único servidor ou uma única partição, vai, invariavelmente, deixar de ter espaço.</span><span class="sxs-lookup"><span data-stu-id="da299-106">If you continue to add new data to a single server or a single partition, it will eventually run out of space.</span></span> <span data-ttu-id="da299-107">Para estar preparado, terá de adotar uma estratégia de partição para **aumentar horizontalmente** em vez de verticalmente.</span><span class="sxs-lookup"><span data-stu-id="da299-107">To prepare for this, you need a partitioning strategy to **scale out** instead of up.</span></span> <span data-ttu-id="da299-108">O dimensionamento horizontal permite-lhe adicionar mais partições à sua base de dados, à medida que a sua aplicação precisa delas.</span><span class="sxs-lookup"><span data-stu-id="da299-108">Scaling out is also called horizontal scaling, and it enables you to add more partitions to your database as your application needs them.</span></span>

<span data-ttu-id="da299-109">A estratégia de partição e dimensionamento horizontal no Azure Cosmos DB é orientada pela chave de partição, que é um valor definido quando cria uma coleção.</span><span class="sxs-lookup"><span data-stu-id="da299-109">The partition and scale-out strategy in Azure Cosmos DB is driven by the partition key, which is a value set when you create a collection.</span></span> <span data-ttu-id="da299-110">Uma vez definida a chave de partição, esta não pode ser alterada sem recriar a coleção, por isso, a seleção da chave de partição correta é uma decisão importante a tomar no início do seu processo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="da299-110">Once the partition key is set, it cannot be changed without recreating the collection, so selecting the right partition key is an important decision to make early in your development process.</span></span>  

<span data-ttu-id="da299-111">Nesta unidade, vaia prender a escolher a chave de partição que melhor se adapta ao seu cenário e vai tirar partido do dimensionamento automático do Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="da299-111">In this unit, you will learn how to choose a partition key that's right for your scenario and will take advantage of the autoscaling that Azure Cosmos DB can do for you.</span></span>

## <a name="partition-key-basics"></a><span data-ttu-id="da299-112">Noções básicas da chave de partição</span><span class="sxs-lookup"><span data-stu-id="da299-112">Partition key basics</span></span>

<span data-ttu-id="da299-113">Uma chave de partição representa um valor na sua base de dados que é consultado com frequência.</span><span class="sxs-lookup"><span data-stu-id="da299-113">A partition key represent a value in your database that's frequently queried.</span></span> <span data-ttu-id="da299-114">Assim, no caso de um retalhista online, usar o valor UserID ou ProductID como a chave de partição é uma boa opção.</span><span class="sxs-lookup"><span data-stu-id="da299-114">So in an online retail scenario, using the UserID or ProductID value as the partition key is a good choice.</span></span> <span data-ttu-id="da299-115">UserID é uma boa opção, porque a sua aplicação está constantemente a recolher informações sobre definições de personalização, carrinho de compras, histórico de pedidos e informações de perfil, entre muitas outras, para o utilizador.</span><span class="sxs-lookup"><span data-stu-id="da299-115">UserID is a good choice, as your application frequently needs to retrieve the personalization settings, shopping cart, order history, and profile information for the user, just to name a few.</span></span> <span data-ttu-id="da299-116">ProductID também é uma boa opção, porque a sua aplicação tem de consultar níveis de inventário, custos de envio, opções de cor, localizações de armazém e muito mais.</span><span class="sxs-lookup"><span data-stu-id="da299-116">ProductID is also a good choice, as your application needs to query inventory levels, shipping costs, color options, warehouse locations, and more.</span></span>

<span data-ttu-id="da299-117">Uma chave de partição deve ter como objetivo distribuir operações por toda a base de dados.</span><span class="sxs-lookup"><span data-stu-id="da299-117">A partition key should aim to distribute operations across the database.</span></span> <span data-ttu-id="da299-118">Deve distribuir os pedidos para evitar ter partições demasiado ativas.</span><span class="sxs-lookup"><span data-stu-id="da299-118">You want to distribute requests in an effort to avoid hot partitions.</span></span> <span data-ttu-id="da299-119">Uma partição demasiado ativa significa que há uma partição que recebe muitos mais pedidos que as restantes partições, o que pode provocar um estrangulamento de débito.</span><span class="sxs-lookup"><span data-stu-id="da299-119">A hot partition is a single partition that receives many more requests than the others, which can create a throughput bottleneck.</span></span> <span data-ttu-id="da299-120">Por exemplo, para a sua aplicação de comércio eletrónico, a hora atual seria uma má escolha para chave de partição, uma vez que todos os dados de entrada iriam para uma única chave de partição.</span><span class="sxs-lookup"><span data-stu-id="da299-120">For example, for your e-commerce application, the current time would be a poor choice of partition key, because all the incoming data would go to a single partition key.</span></span> <span data-ttu-id="da299-121">UserID ou ProductID seriam uma melhor escolha, uma vez que é provável que todos os utilizadores do seu site adicionem e atualizem o respetivo carrinho de compras ou informações de perfil com a mesma frequência, o que distribui as leituras e escritas por todas as partições de utilizador.</span><span class="sxs-lookup"><span data-stu-id="da299-121">UserID or ProductID would be better, as all the users on your site would likely be adding and updating their shopping cart or profile information at about the same frequency, which distributes the reads and writes across all the user partitions.</span></span> <span data-ttu-id="da299-122">Da mesma forma, seria provável que as atualizações para os dados do produto fossem também distribuídas de forma bastante uniforme, fazendo do ProductID uma boa escolha para chave de partição.</span><span class="sxs-lookup"><span data-stu-id="da299-122">Likewise, updates to product data would also likely be fairly evenly distributed, making ProductID a good partition key choice.</span></span>

<span data-ttu-id="da299-123">Cada chave de partição tem uma capacidade de armazenamento máxima de 10 GB, que corresponde ao tamanho de uma partição física do Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="da299-123">Each partition key has a maximum storage space of 10 GB, which is the size of one physical partition in Azure Cosmos DB.</span></span> <span data-ttu-id="da299-124">Se o seu único registo de UserID ou ProductID for superior a 10 GB, pondere a utilização de uma chave composta, para que cada registo seja menor.</span><span class="sxs-lookup"><span data-stu-id="da299-124">So if your single UserID or ProductID record is going to be larger than 10 GB, think about using a composite key instead so that each record is smaller.</span></span> <span data-ttu-id="da299-125">Um exemplo de chave composta seria UserID-date, o que seria qualquer coisa como NomeCliente 08072018.</span><span class="sxs-lookup"><span data-stu-id="da299-125">An example of a composite key would be UserID-date, which would look like CustomerName-08072018.</span></span> <span data-ttu-id="da299-126">Esta abordagem de chave composta iria permitir-lhe criar uma nova partição, para cada dia que um utilizador visitasse o site.</span><span class="sxs-lookup"><span data-stu-id="da299-126">This composite key approach would enable you to create a new partition for each day a user visited the site.</span></span>

## <a name="best-practices"></a><span data-ttu-id="da299-127">Melhores práticas</span><span class="sxs-lookup"><span data-stu-id="da299-127">Best practices</span></span>

<span data-ttu-id="da299-128">Se está a tentar determinar qual a melhor chave de partição para si e a solução não é óbvia, aqui ficam algumas dicas a ter em conta.</span><span class="sxs-lookup"><span data-stu-id="da299-128">When you're trying to determine the right partition key and the solution isn't obvious, here are a few tips to keep in mind.</span></span>

* <span data-ttu-id="da299-129">Não tenha medo de ter demasiadas chaves de partição.</span><span class="sxs-lookup"><span data-stu-id="da299-129">Don’t be afraid of having too many partition keys.</span></span> <span data-ttu-id="da299-130">Quantas mais chaves de partição tiver, mais dimensionamento tem.</span><span class="sxs-lookup"><span data-stu-id="da299-130">The more partition keys you have, the more scalability you have.</span></span>

* <span data-ttu-id="da299-131">Para determinar a melhor chave de partição para uma carga de trabalho de leitura intensiva, analise as primeiras três a cinco consultas que tenciona utilizar.</span><span class="sxs-lookup"><span data-stu-id="da299-131">To determine the best partition key for a read-heavy workload, review the top three to five queries you plan on using.</span></span> <span data-ttu-id="da299-132">O valor mais frequentemente incluído na cláusula ONDE é um bom candidato para a chave de partição.</span><span class="sxs-lookup"><span data-stu-id="da299-132">The value most frequently included in the WHERE clause is a good candidate for the partition key.</span></span>

* <span data-ttu-id="da299-133">Para cargas de trabalho de escrita intensiva, terá de compreender as necessidades de transação da sua carga de trabalho, porque a chave de partição é o âmbito das transações de vários documentos.</span><span class="sxs-lookup"><span data-stu-id="da299-133">For write-heavy workloads, you'll need to understand the transactional needs of your workload, because the partition key is the scope of multi-document transactions.</span></span>
