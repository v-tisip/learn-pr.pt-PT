<span data-ttu-id="6a1d9-101">O Azure Key Vault utiliza o **Azure Active Directory** para autenticar os utilizadores e as aplicações que tentam aceder a um cofre.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-101">Azure Key Vault uses **Azure Active Directory** to authenticate users and applications that try to access a vault.</span></span> <span data-ttu-id="6a1d9-102">Para conceder acesso à aplicação Web ao cofre, primeiro é necessário registar a aplicação no Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-102">To grant our web application access to the vault, we first need to register our app with Azure Active Directory.</span></span> <span data-ttu-id="6a1d9-103">O registo cria uma identidade para a aplicação.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-103">Registering creates an identity for the app.</span></span> <span data-ttu-id="6a1d9-104">Assim que existir uma identidade, podemos atribuir-lhe as permissões do cofre.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-104">Once we have an identity, we can assign vault permissions to it.</span></span>

<span data-ttu-id="6a1d9-105">As aplicações e os utilizadores são autenticados no Key Vault com um token de autenticação do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-105">Apps and users authenticate to Key Vault using an Azure Active Directory authentication token.</span></span> <span data-ttu-id="6a1d9-106">Obter um token do Azure Active Directory requer um segredo ou certificado, uma vez que qualquer pessoa com um token pode utilizar a identidade da aplicação para aceder a todos os segredos existentes no cofre.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-106">Getting a token from Azure Active Directory requires a secret or certificate, because anyone with a token could use the application identity to access all of the secrets in the vault.</span></span>

<span data-ttu-id="6a1d9-107">Os segredos da aplicação estão protegidos no cofre, mas ainda é necessário manter um segredo ou certificado fora do cofre para poder aceder-lhes!</span><span class="sxs-lookup"><span data-stu-id="6a1d9-107">Our application secrets are secure in the vault, but we still need to keep a secret or certificate outside of the vault in order to access them!</span></span> <span data-ttu-id="6a1d9-108">Este problema é denominado *problema de arranque*  e o Azure tem uma solução.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-108">This problem is called the *bootstrapping problem*, and Azure has a solution for it.</span></span>

## <a name="managed-service-identity"></a><span data-ttu-id="6a1d9-109">Identidade do Serviço Gerido</span><span class="sxs-lookup"><span data-stu-id="6a1d9-109">Managed Service Identity</span></span>

<span data-ttu-id="6a1d9-110">A *Identidade do Serviço Gerido* (MSI) é uma funcionalidade do Serviço de Aplicações do Azure que a aplicação pode utilizar para aceder ao Key Vault e outros serviços do Azure sem ter de gerir um único segredo.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-110">*Managed Service Identity* (MSI) is a feature of Azure App Service that your app can use to access Key Vault and other Azure services without having to manage even a single secret.</span></span> <span data-ttu-id="6a1d9-111">A utilização do MSI é mais simples e segura do que gerir um segredo por si.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-111">Using MSI is simpler and more secure than managing a secret yourself.</span></span>

<span data-ttu-id="6a1d9-112">Quando ativar o MSI, o Azure ativa um serviço REST de concessão de tokens separado para ser utilizado pela aplicação.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-112">When you enable MSI, Azure activates a separate token-granting REST service specifically for use by your app.</span></span> <span data-ttu-id="6a1d9-113">Quando a aplicação solicita um token ao serviço de tokens do MSI, o serviço contacta o Azure Active Directory para obter um token para a identidade do MSI e devolve-o à aplicação para utilização no Key Vault.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-113">When your app requests a token from the MSI token service, the service contacts Azure Active Directory to get a token for the MSI identity and hands it back to your app for use with Key Vault.</span></span> <span data-ttu-id="6a1d9-114">A parte mais importante deste fluxo de trabalho é a forma como a aplicação efetua a autenticação no serviço de tokens do MSI &mdash;. Em vez de exigir um segredo ou certificado que tem de gerir na sua configuração, a aplicação utiliza um segredo que o Azure injeta em segurança nas variáveis de ambiente durante o arranque.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-114">The most important part of this workflow is the way that your app authenticates to the MSI token service &mdash; instead of requiring a secret or certificate you need to manage in your configuration, your app uses a secret that Azure securely injects into its environment variables when it starts up.</span></span> <span data-ttu-id="6a1d9-115">Não tem de gerir ou armazenar este valor do segredo em lado nenhum.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-115">You don't need to manage or store this secret value anywhere.</span></span> <span data-ttu-id="6a1d9-116">Nada fora da aplicação pode aceder a este segredo ou ponto final do serviço de tokens do MSI.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-116">Nothing outside of your app can access this secret or the MSI token service endpoint.</span></span>

<span data-ttu-id="6a1d9-117">O MSI também regista a aplicação no Azure Active Directory e eliminará o registo caso desative o MSI ou elimine a aplicação.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-117">MSI also registers your app in Azure Active Directory for you, and will delete the registration if you disable MSI or delete the app.</span></span>

<span data-ttu-id="6a1d9-118">O MSI está disponível em todas as edições do Azure Active Directory, incluindo a edição Gratuita incluída numa subscrição do Azure.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-118">MSI is available in all editions of Azure Active Directory, including the Free edition included with an Azure subscription.</span></span> <span data-ttu-id="6a1d9-119">Utilizá-lo no Serviço de Aplicações não tem custos adicionais, não requer configurações e pode ser ativado ou desativado numa aplicação em qualquer altura.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-119">Using it in App Service has no extra cost and requires no configuration, and it can be enabled or disabled on an app at any time.</span></span>

> [!NOTE]
> <span data-ttu-id="6a1d9-120">O MSI não é atualmente suportado para aplicações Web do Linux ou do Contentor.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-120">MSI is not currently supported for Linux or Container web apps.</span></span>

<span data-ttu-id="6a1d9-121">A ativação do MSI requer apenas um único comando da CLI do Azure sem qualquer configuração.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-121">Enabling MSI requires only a single Azure CLI command with no configuration.</span></span> <span data-ttu-id="6a1d9-122">Faremos isto na unidade 5 quando configurarmos uma aplicação do Serviço de Aplicações e a implementarmos no Azure.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-122">We'll do it in unit 5 when we set up an App Service app and deploy to Azure.</span></span> <span data-ttu-id="6a1d9-123">Antes disso, vamos aplicar os conhecimentos do MSI para escrever o código para a aplicação.</span><span class="sxs-lookup"><span data-stu-id="6a1d9-123">Before that, though, we're going to apply our knowledge of MSI to write the code for our app.</span></span>